基于关键词的搜索引擎包括一个数以亿计文件的集合。
搜索引擎的一次关键词检索需要检索所有文件以确定是否含有目标关键词。
这不是一件容易的事儿，它需要在几十毫秒内返回检索结果。
现在我们考虑当文件集合在单机RAM能满足的情况下的小数据了版本下的问题。
给定一百万个文件，平均大小为10kb，请设计一个系统满足：给定关键词集合，返回包含其的文件子集。
*提示：想想书的索引*
答：主流的方法是构建倒排索引。在倒排索引中，我们根据每个单词，存储其出现的位置结果序列。
序列可以是数组或链表。位置可以定义为文件的ID或文件的偏移。而且位置结果序列以位置排序(例如先以文件ID排序，然后再以偏移排序)。
当我们在文件中查找是否含有关键词集合是，我们需要做的就是寻找每个单词位置结果序列的交集。
由于位置结果已经排好序了，交集可以的时间复杂度与结果序列的总计长度成比例。
下面是我们列举的一些优化点：
— 压缩——压缩倒排索引既可以存储更多的文件，也可以提高内存局部性（减少缓存掉靶）。
由于我们存储的是排好序的队列，那我们可以使用增量压缩的方法，这样我们就只需存储于成功元素的不同点就可以。这样增量就可以用很少的比特标识。
— 缓存——检索的分布性通常是相对倾斜的，这样能提高最常检索结果的缓存命中率。
- 频数优化——由于检索结果不需要返回每个匹配到的文件（只需要前10个或者类似这样的），只需要最高质量的那一小部分被用来应答检索。
这就是说，我们可以使用两个倒排索引，一个是存储在RAM中的高质量的文件，另一个是仍然在硬盘中的剩下的文件。
通过这个方法，如果我们可以实现将二级索引的规模保持在一个很小的数量，但是仍然能满足合理的吞吐量和延迟。
- 交集顺序——由于总的交集时间依赖于序列的总长度，那将较小的集合先进行合并将很有必要。
例如，我们搜索"USA GDP 2009"，我们先求"GDP"和"2009"的集合，再去求与"USA"的集合，这样会更合理。
我们还可以使用多层次的索引以提高文件的准确性。对于一个高优先的网页，我们可以把页面分解成段落和句子（这些可以独立的被索引）。
这样的话对关键词集合的结果交集可能是相同的文本。我们从这些结果队列中选取最靠近索引值的结果。
排序序列求交集可以参照14.1，数据挖掘参照13.7